openapi: 3.0.3
info:
  title: Personalization API
  description: Chapter content personalization based on user skill profile
  version: 1.0.0

servers:
  - url: http://localhost:8000/api
    description: Development server

tags:
  - name: Personalization
    description: Content personalization operations

paths:
  /personalize:
    post:
      tags:
        - Personalization
      summary: Personalize chapter content
      description: |
        Transform chapter content based on user's skill levels and hardware access.

        **Personalization Logic**:
        - **Explanation depth**: Based on AI/ML skill levels (higher = more concise, advanced terminology)
        - **Code complexity**: Based on Python/ROS skill levels (higher = advanced patterns, optimization focus)
        - **Hardware assumptions**: Based on hardware access flags (GPU/Jetson/Robot examples vs cloud-only alternatives)

        **Performance**: Must complete in <10 seconds for chapters up to 5000 words (SC-002)
      operationId: personalizeChapter
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PersonalizeRequest'
      responses:
        '200':
          description: Chapter personalized successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonalizeResponse'
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '400':
          description: Bad request (invalid input)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Rate limit exceeded"
                details:
                  message: "OpenRouter API rate limit reached. Please try again in 60 seconds."
                  retryAfter: 60
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    PersonalizeRequest:
      type: object
      required:
        - chapterId
        - chapterContent
        - userProfile
      properties:
        chapterId:
          type: string
          example: "module-1-chapter-3"
          description: Unique chapter identifier
        chapterContent:
          type: string
          example: "# Chapter 3: Robot Kinematics\n\n## Introduction\n..."
          description: Original chapter markdown content
        userProfile:
          $ref: '#/components/schemas/UserProfile'

    PersonalizeResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            chapterId:
              type: string
              example: "module-1-chapter-3"
            personalizedContent:
              type: string
              example: "# Chapter 3: Robot Kinematics (Personalized)\n\n## Introduction\n..."
              description: Transformed markdown content
            metadata:
              type: object
              properties:
                llmModel:
                  type: string
                  example: "meta-llama/llama-3.3-70b-instruct"
                tokenUsage:
                  type: object
                  properties:
                    inputTokens:
                      type: integer
                      example: 2500
                    outputTokens:
                      type: integer
                      example: 2800
                processingTimeMs:
                  type: integer
                  example: 8500
                  description: Processing time in milliseconds

    UserProfile:
      type: object
      properties:
        userId:
          type: string
          format: uuid
        skillLevels:
          type: object
          properties:
            ai:
              type: integer
              minimum: 1
              maximum: 5
            ml:
              type: integer
              minimum: 1
              maximum: 5
            ros:
              type: integer
              minimum: 1
              maximum: 5
            python:
              type: integer
              minimum: 1
              maximum: 5
            linux:
              type: integer
              minimum: 1
              maximum: 5
        hardwareAccess:
          type: object
          properties:
            gpu:
              type: boolean
            jetson:
              type: boolean
            robot:
              type: boolean
            cloudOnly:
              type: boolean

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        details:
          type: object
          additionalProperties: true
